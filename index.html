<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Nutri Data Pro</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="logo.png">
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

    <div class="background-blobs">
        <div class="blob blob-1"></div>
    </div>

    <div class="mobile-header" style="display:none;"> <div class="logo" style="display:flex; align-items:center; gap:10px;">
            <img src="logo.png" style="height:30px;">
            <h3 style="margin:0; color:white;">NUTRI<span style="color:var(--brand-red)">DATA</span></h3>
        </div>
        <button class="mobile-menu-btn" onclick="toggleSidebar()" style="color:white; background:none; border:none; font-size:1.5rem;"><i class="bi bi-list"></i></button>
    </div>
    
    <div class="overlay" onclick="toggleSidebar()"></div>

    <div class="app-container">
        <aside class="sidebar" id="sidebar">
            <div style="text-align:center; margin-bottom:30px;">
                <img src="logo.png" style="height:80px; margin-bottom:10px;">
                <h2 style="margin:0; color:white;">NUTRI<span style="color:var(--brand-red)">DATA</span>PRO</h2>
            </div>
            
            <nav id="adminNav" style="display:none;">
                <button class="nav-btn active" onclick="showAdminSection('clients'); toggleSidebar()"><i class="bi bi-people"></i> Atletas</button>
                <button class="nav-btn" onclick="showAdminSection('diets'); toggleSidebar()"><i class="bi bi-collection"></i> Biblioteca</button>
                <button class="nav-btn" onclick="showAdminSection('inbox'); toggleSidebar()"><i class="bi bi-chat-left"></i> Mensajes</button>
            </nav>

            <nav id="athleteNav" style="display:none;">
                <button class="nav-btn active" onclick="showAthleteSection('myPlan'); toggleSidebar()"><i class="bi bi-calendar-check"></i> Mi Plan</button>
                <button class="nav-btn" onclick="showAthleteSection('education'); toggleSidebar()"><i class="bi bi-book"></i> Guía & Tips</button>
                <button class="nav-btn" onclick="showAthleteSection('evolution'); toggleSidebar()"><i class="bi bi-graph-up"></i> Evolución</button>
                <button class="nav-btn" onclick="showAthleteSection('history'); toggleSidebar()"><i class="bi bi-clock-history"></i> Historial</button>
                <button class="nav-btn" onclick="showAthleteSection('notes'); toggleSidebar()"><i class="bi bi-pencil"></i> Notas</button>
            </nav>

            <div style="margin-top:auto;">
                <div id="authContainer">
                    <button class="btn-primary" onclick="openModal('loginModal')">Acceder</button>
                </div>
            </div>
        </aside>

        <main class="main-content">
            <div id="adminView" style="display:none;">
                <section id="clients-section">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                        <h1>Atletas Activos</h1>
                        <button class="btn-primary" onclick="openModal('clientModal')" style="width:auto;">+ Nuevo</button>
                    </div>
                    <div class="grid-container" id="clients-grid"></div>
                </section>
                <section id="diets-section" style="display:none;">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; flex-wrap:wrap; gap:10px;">
                        <h1>Biblioteca</h1>
                        <div style="display:flex; gap:10px;">
                            <input type="text" id="searchKcal" class="glass-input" placeholder="Buscar..." oninput="filterDiets()" style="width:150px; margin:0;">
                            <button class="btn-primary" onclick="resetDatabaseManual()" style="width:auto; background:#333;">Reset DB</button>
                        </div>
                    </div>
                    <div class="grid-container" id="diets-grid"></div>
                </section>
                <section id="inbox-section" style="display:none;">
                    <h1>Mensajes</h1>
                    <div id="inbox-list"></div>
                </section>
            </div>

            <div id="athleteView" style="display:none;">
                <section id="myPlan-section">
                    <h1 id="athleteGreeting">Hola</h1>
                    <div id="myCurrentDietContainer"></div>
                </section>
                <section id="education-section" style="display:none;"><div id="eduContent"></div></section>
                <section id="evolution-section" style="display:none;"><h1>Evolución</h1><div class="card"><canvas id="weightChart"></canvas></div><button class="btn-primary" onclick="openModal('checkinModal')" style="margin-top:20px;">+ Peso</button><div id="weightHistoryList" style="margin-top:20px;"></div></section>
                <section id="history-section" style="display:none;"><div id="historyList" class="grid-container"></div></section>
                <section id="notes-section" style="display:none;"><h1>Notas</h1><textarea id="athleteNoteInput" class="glass-input" rows="3"></textarea><button class="btn-primary" onclick="sendAthleteNote()" style="margin-top:10px;">Enviar</button><div id="myNotesHistory" style="margin-top:20px;"></div></section>
            </div>
        </main>
    </div>

    <div id="dietViewModal" class="modal">
        <div class="modal-content">
            <div class="modal-header-fixed">
                <h3 style="margin:0; color:white;">Plan Nutricional</h3>
                <button class="close-btn" onclick="closeModal('dietViewModal')"><i class="bi bi-x-lg"></i></button>
            </div>
            <div class="modal-body" id="diet-detail-content">
                </div>
        </div>
    </div>

    <div id="loginModal" class="modal" style="align-items:center; justify-content:center;">
        <div class="modal-content" style="max-width:400px; height:auto; border-radius:20px;">
            <div style="padding:30px; text-align:center;">
                <button class="close-btn" onclick="closeModal('loginModal')" style="position:absolute; right:10px; top:10px;"><i class="bi bi-x"></i></button>
                <h2>Acceso</h2>
                <form id="loginForm">
                    <input type="email" id="loginEmail" class="glass-input" placeholder="Email" required>
                    <input type="password" id="loginPass" class="glass-input" placeholder="Pass" required>
                    <button type="submit" class="btn-primary" style="margin-top:20px;">Entrar</button>
                </form>
            </div>
        </div>
    </div>

    <script type="module" src="js/app.js"></script>
</body>
</html>